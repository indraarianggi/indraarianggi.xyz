---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import PostCard from "@/components/astro/PostCard.astro";
import { calculateReadingTime } from "@/lib/reading-time";

// Get all published posts, sorted by date (newest first)
const allPosts = await getCollection("posts");
const posts = allPosts
  .filter((post) => post.data.published !== false)
  .sort(
    (a, b) =>
      new Date(b.data.time.created).getTime() -
      new Date(a.data.time.created).getTime()
  );
---

<BaseLayout
  title="Blog"
  description="Articles and insights about frontend development, modern web technologies, and software engineering."
>
  <div class="container mx-auto px-4 py-20">
    <div class="mx-auto max-w-6xl">
      <!-- Header -->
      <div class="mb-12">
        <div class="mb-4 flex items-center gap-2">
          <div class="bg-gradient-teal-emerald h-1 w-12 rounded-full"></div>
          <span class="text-primary font-medium">Blog</span>
        </div>
        <h1 class="mb-4 text-4xl font-bold md:text-5xl">
          Articles & Insights
        </h1>
        <p class="text-muted-foreground max-w-2xl text-lg">
          Thoughts on frontend development, modern web technologies, and
          software engineering best practices.
        </p>
      </div>

      <!-- Posts Grid -->
      {
        posts.length > 0 ? (
          <div class="grid gap-6 md:grid-cols-2">
            {posts.map((post) => {
              const rt = calculateReadingTime(post.body);
              return (
                <PostCard
                  title={post.data.title}
                  excerpt={post.data.excerpt}
                  date={post.data.time.created}
                  readingTime={rt.text}
                  slug={post.slug}
                  tags={post.data.tags}
                />
              );
            })}
          </div>
        ) : (
          <div class="text-muted-foreground rounded-lg border p-12 text-center">
            <p class="text-lg">No blog posts published yet.</p>
          </div>
        )
      }

      <!-- Stats -->
      <div class="mt-12 border-t pt-8">
        <p class="text-muted-foreground text-center text-sm">
          {posts.length} {posts.length === 1 ? "article" : "articles"} published
        </p>
      </div>
    </div>
  </div>
</BaseLayout>
