---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import PostCard from "@/components/astro/PostCard.astro";
import { calculateReadingTime } from "@/lib/reading-time";

// Get all published posts, sorted by date (newest first)
const allPosts = await getCollection("posts");
const posts = allPosts
  .filter((post) => post.data.published !== false)
  .sort(
    (a, b) =>
      new Date(b.data.time.created).getTime() -
      new Date(a.data.time.created).getTime()
  );
---

<BaseLayout
  title="Blog"
  description="Insights on Development & Technology â€“ lessons learned and discoveries from my journey as a software engineer."
>
  <div class="min-h-screen">
    {/* Hero Section with Gradient Background */}
    <section class="relative overflow-hidden py-20 md:py-32">
      {/* Background decoration */}
      <div class="from-secondary/5 to-primary/5 absolute inset-0 bg-gradient-to-br via-transparent" />
      <div class="bg-accent/10 absolute top-20 right-20 h-72 w-72 rounded-full blur-3xl" />
      <div class="bg-primary/10 absolute bottom-20 left-20 h-96 w-96 rounded-full blur-3xl" />
      
      <div class="relative container mx-auto px-4">
        <div class="mx-auto max-w-6xl">
          <div class="space-y-8">
            <div class="space-y-6">
              <div class="flex items-center gap-2">
                <div class="from-secondary to-primary h-1 w-12 rounded-full bg-gradient-to-r" />
                <span class="text-primary font-medium">
                  Technical Writing
                </span>
              </div>
              <h1 class="text-4xl leading-tight font-bold md:text-5xl md:leading-[1] lg:text-6xl">
                Insights on{" "}
                <span class="text-gradient-emerald-coral block">
                  Development & Technology
                </span>
              </h1>
              <p class="text-muted-foreground text-xl">
                Sharing lessons learned and insights gained throughout my
                journey as a software engineer. From technical discoveries to
                problem-solving approaches and everything I&apos;ve picked up
                along the way.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Posts Section -->
    <div class="container mx-auto px-4 py-16">
      <div class="mx-auto max-w-6xl">

        <!-- Posts Grid -->
        {
          posts.length > 0 ? (
            <div class="grid gap-6 md:grid-cols-2">
              {posts.map((post) => {
                const rt = calculateReadingTime(post.body);
                return (
                  <PostCard
                    title={post.data.title}
                    excerpt={post.data.excerpt}
                    date={typeof post.data.time.created === 'string' ? post.data.time.created : post.data.time.created.toISOString()}
                    readingTime={rt.text}
                    slug={post.slug}
                    tags={post.data.tags}
                  />
                );
              })}
            </div>
          ) : (
            <div class="text-muted-foreground rounded-lg border p-12 text-center">
              <p class="text-lg">No blog posts published yet.</p>
            </div>
          )
        }

        <!-- Stats -->
        <div class="mt-16 border-t pt-8">
          <p class="text-muted-foreground text-center text-sm">
            {posts.length} {posts.length === 1 ? "article" : "articles"} published
          </p>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>
